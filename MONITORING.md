# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è Telegram –±–æ—Ç–∞

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ Telegram.

## –í–∞—Ä–∏–∞–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 1. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∫—Ä–∏–ø—Ç `monitor-bot.sh` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:**
```bash
cd /var/www/tg-support-bot
chmod +x monitor-bot.sh
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env:**
```env
TELEGRAM_GROUP_ID=-1003530272340  # ID –≥—Ä—É–ø–ø—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
TELEGRAM_TOKEN=your_bot_token     # –¢–æ–∫–µ–Ω –±–æ—Ç–∞
```

3. **–î–æ–±–∞–≤—å—Ç–µ –≤ crontab:**
```bash
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
```cron
*/5 * * * * /var/www/tg-support-bot/monitor-bot.sh >> /var/log/bot-monitor.log 2>&1
```

–ò–ª–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (–¥–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫):
```cron
* * * * * /var/www/tg-support-bot/monitor-bot.sh >> /var/log/bot-monitor.log 2>&1
```

#### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫—Ä–∏–ø—Ç:

- ‚úÖ –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (pet, nginx, pgdb, redis, queue)
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å HTTP endpoints
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ Telegram webhook
- ‚úÖ –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
./monitor-bot.sh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f /var/log/bot-monitor.log
```

### 2. Health Check Endpoints

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

#### –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

```bash
curl https://tg-support-bot-garetski.ru/api/health/simple
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "timestamp": "2026-01-27T20:00:00+00:00"
}
```

HTTP –∫–æ–¥:
- `200` - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- `503` - –ø—Ä–æ–±–ª–µ–º—ã

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
curl https://tg-support-bot-garetski.ru/api/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "timestamp": "2026-01-27T20:00:00+00:00",
  "checks": {
    "database": {
      "status": "ok",
      "message": "Database connection successful"
    },
    "redis": {
      "status": "ok",
      "message": "Redis connection successful"
    },
    "telegram_webhook": {
      "status": "ok",
      "url": "https://tg-support-bot-garetski.ru/api/telegram/bot",
      "pending_updates": 0,
      "last_error": null
    },
    "disk": {
      "status": "ok",
      "free_space_gb": 5.2,
      "total_space_gb": 10.0,
      "used_percent": 48.0
    }
  }
}
```

HTTP –∫–æ–¥:
- `200` - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `503` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### 3. –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### UptimeRobot (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://uptimerobot.com
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä:
   - **Type:** HTTP(s)
   - **URL:** `https://tg-support-bot-garetski.ru/api/health/simple`
   - **Interval:** 5 minutes
   - **Alert Contacts:** –í–∞—à email/Telegram

#### Pingdom

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://www.pingdom.com
2. –°–æ–∑–¥–∞–π—Ç–µ HTTP check –Ω–∞ `/api/health/simple`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

#### Better Uptime

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://betteruptime.com
2. –î–æ–±–∞–≤—å—Ç–µ HTTP check
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Telegram

#### Telegram Bot –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

```bash
# –í .env –¥–æ–±–∞–≤—å—Ç–µ:
MONITOR_BOT_TOKEN=your_monitor_bot_token
MONITOR_CHAT_ID=your_chat_id
```

### 4. Sentry (–¥–ª—è –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Sentry, –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `.env`:
```env
SENTRY_LARAVEL_DSN=https://your-sentry-dsn@sentry.io/project-id
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –≥—Ä—É–ø–ø—É (`TELEGRAM_GROUP_ID`):

```env
TELEGRAM_GROUP_ID=-1003530272340
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª –≤ Telegram
2. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü–æ–ª—É—á–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `@your_monitor_channel`)
4. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:
```env
MONITOR_CHAT_ID=@your_monitor_channel
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –õ–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

1. –ü–æ–ª—É—á–∏—Ç–µ —Å–≤–æ–π Chat ID:
   - –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É @userinfobot
   - –û–Ω –≤–µ—Ä–Ω–µ—Ç –≤–∞—à Chat ID
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `monitor-bot.sh`:
```bash
MONITOR_CHAT_ID="123456789"  # –í–∞—à Chat ID
```

## –ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ:

```
‚ö† –ü—Ä–æ–±–ª–µ–º—ã —Å –±–æ—Ç–æ–º

–í—Ä–µ–º—è: 2026-01-27 20:15:30
–°–µ—Ä–≤–µ—Ä: mjcpzudxrq

‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx –Ω–µ –∑–∞–ø—É—â–µ–Ω
‚ùå Health endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚ö† –î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞ 85%

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: docker-compose logs --tail=50 app
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏:

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤ —Å–∫—Ä–∏–ø—Ç.

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `monitor-bot.sh` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ª–æ–≥–æ–≤
LOG_SIZE=$(du -sh storage/logs/laravel.log 2>/dev/null | cut -f1)
if [ "$LOG_SIZE" -gt "100M" ]; then
    PROBLEMS+=("‚ö† –õ–æ–≥ —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: $LOG_SIZE")
fi
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

–í crontab:
- `*/1 * * * *` - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- `*/5 * * * *` - –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `*/15 * * * *` - –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- `0 * * * *` - –∫–∞–∂–¥—ã–π —á–∞—Å

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `/var/log/bot-monitor.log`:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/bot-monitor.log

# –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º
grep "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã" /var/log/bot-monitor.log
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Å–∫—Ä–∏–ø—Ç:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É–ø–∞–≤—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
for container in pet nginx pgdb redis laravel_queue; do
    if ! check_container "$container"; then
        docker-compose restart "$container"
        send_notification "üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: $container"
    fi
done
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `monitor-bot.sh`
2. **–î–æ–±–∞–≤—å—Ç–µ –≤–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** UptimeRobot –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Sentry:** –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏:** `docker-compose logs --tail=100 app`

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
./monitor-bot.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl https://tg-support-bot-garetski.ru/api/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
TELEGRAM_TOKEN=$(grep TELEGRAM_TOKEN .env | cut -d '=' -f2 | tr -d '"')
curl "https://api.telegram.org/bot${TELEGRAM_TOKEN}/getWebhookInfo"
```


